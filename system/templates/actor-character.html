<form class="gambiarra-sheet" autocomplete="off">
  <header class="sheet-header">
    <h1>
      <input name="name" type="text" value="{{actor.name}}" placeholder="Nome do personagem" />
    </h1>

    <p class="arquetipo">
      <label>ArquÃ©tipo</label>
      <input name="system.meta.arquetipo" type="text" value="{{system.meta.arquetipo}}" placeholder="Ex: A Atleta" />
    </p>
  </header>

  {{!-- BUG --}}
  {{#if system.meta.bug.ativo}}
  <section class="bug-state {{system.meta.bug.intensidade}}">
    ğŸ <strong>BUG {{system.meta.bug.intensidade}}</strong><br />
    {{system.meta.bug.descricao}}

    {{#if isGM}}
      <button type="button" class="clear-bug">Resolver BUG</button>
    {{/if}}
  </section>
  {{/if}}

  {{!-- ATRIBUTOS --}}
  <section class="attributes">
    <h2>ğŸ² Atributos (quantidade de dados)</h2>

    <div class="attribute corpo">
      <h3>ğŸŸ¢ Corpo</h3>
      <input name="system.attributes.corpo.value" type="number" min="1" max="4" value="{{system.attributes.corpo.value}}" />
    </div>

    <div class="attribute mente">
      <h3>ğŸ”µ Mente</h3>
      <input name="system.attributes.mente.value" type="number" min="1" max="4" value="{{system.attributes.mente.value}}" />
    </div>

    <div class="attribute coracao">
      <h3>ğŸ”´ CoraÃ§Ã£o</h3>
      <input name="system.attributes.coracao.value" type="number" min="1" max="4" value="{{system.attributes.coracao.value}}" />
    </div>

    <p class="hint">Regra: Corpo + Mente + CoraÃ§Ã£o = 6 (sem zeros).</p>
  </section>

  {{!-- BOTÃƒO ROLAR --}}
  <section class="roll-section">
    <button type="button" class="roll-desafio">ğŸ² Rolar Desafio</button>
  </section>

  {{!-- PODERES --}}
  <section class="powers">
    <h2>âš¡ Poderes Gambiarra</h2>

    {{#if (eq system.meta.poderes.length 0)}}
      <p class="hint">Nenhum poder ainda.<br />Eles surgem em momentos de tensÃ£o.</p>
    {{/if}}

    <ul class="power-list">
      {{#each system.meta.poderes as |poder index|}}
      <li class="power power-{{poder.estado}}">
        <header>
          <strong>{{poder.nome}}</strong>
          <span class="state">{{poder.estado}}</span>
        </header>

        <p class="description">{{poder.descricao}}</p>

        {{#if poder.efeitosPossiveis}}
        <ul class="power-effects">
          {{#each poder.efeitosPossiveis}}
            <li>
              {{#if (eq this "dado")}}ğŸŸ£ Dado Roxo{{/if}}
              {{#if (eq this "reduzir-dificuldade")}}ğŸ¯ Reduz dificuldade{{/if}}
              {{#if (eq this "rerrolar")}}ğŸ” Re-rolar 1 dado{{/if}}
            </li>
          {{/each}}
        </ul>
        {{/if}}

        {{#if isGM}}
        <div class="power-controls">
          <button type="button" data-index="{{index}}" data-set="ativo">Ativar</button>
          <button type="button" data-index="{{index}}" data-set="esgotado">Esgotar</button>
          <button type="button" data-index="{{index}}" data-set="fora">Fora</button>
        </div>
        {{/if}}
      </li>
      {{/each}}
    </ul>

    {{#if (lt system.meta.poderes.length 2)}}
      {{#if isGM}}
        <button type="button" class="add-power">â• Despertar Poder</button>
      {{/if}}
    {{/if}}
  </section>

  {{!-- EFEITOS PERMANENTES --}}
  <section class="effects">
    <h2>ğŸ§  Efeitos do NÃ³</h2>

    {{#if (or system.meta.marcas.length system.meta.custos.length system.meta.corrupcoes.length)}}
      {{#if system.meta.marcas.length}}
        <h3>ğŸ§¬ Marcas do NÃ³</h3>
        <ul>
          {{#each system.meta.marcas}}
            <li><strong>{{this.nome}}</strong> â€” {{this.descricao}}</li>
          {{/each}}
        </ul>
      {{/if}}

      {{#if system.meta.custos.length}}
        <h3>ğŸ’” Custos Emocionais</h3>
        <ul>
          {{#each system.meta.custos}}
            <li><strong>{{this.nome}}</strong> â€” {{this.descricao}}</li>
          {{/each}}
        </ul>
      {{/if}}

      {{#if system.meta.corrupcoes.length}}
        <h3>ğŸ§© CorrupÃ§Ãµes</h3>
        <ul>
          {{#each system.meta.corrupcoes}}
            <li><strong>{{this.nome}}</strong> â€” {{this.descricao}}</li>
          {{/each}}
        </ul>
      {{/if}}
    {{else}}
      <p class="hint">Nenhum efeito permanenteâ€¦ ainda.</p>
    {{/if}}

    {{#if isGM}}
      <button type="button" class="add-effect">â• Registrar Efeito Permanente</button>
    {{/if}}
  </section>

  {{!-- ITENS --}}
  <section class="items">
    <h2>ğŸ’ Itens do NÃ³</h2>
    <ul>
      {{#each items as |item|}}
      <li>
        {{item.name}}
        {{#if (and ../system.meta.bug.ativo item.system.reageABug)}}
          {{#if ../isGM}}
            <button type="button" class="use-item-bug" data-item-id="{{item.id}}">ğŸ Usar no BUG</button>
          {{/if}}
        {{/if}}
      </li>
      {{/each}}
    </ul>
  </section>
</form>
